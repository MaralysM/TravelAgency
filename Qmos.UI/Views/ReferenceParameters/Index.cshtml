@{
    @model Qmos.UI.ViewModels.ReferenceParametersViewModel
    ViewData["Title"] = "Reference Parameters";
    ViewData["Root"] = "Mangement";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/css/plugins/sweetalert/sweetalert.css">
<link rel="stylesheet" href="~/css/plugins/dataTables/datatables.min.css" />
<link rel="stylesheet" href="~/css/plugins/toastr/toastr.min.css" />
<partial name="_HeaderDetailPartial" view-data="ViewData" />

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content  p-md">

                    <div class="col-lg-12">
                        <div class="form-group row text-left">
                            <div class="col-lg-12">
                                @Html.ValidationSummary(false, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-lg-12">
                                <span class="text-danger"> *</span><span>
                                    Required fields
                                </span>
                            </div>
                        </div>
                        <form asp-action="Post" role="form" method="post">
                            <div class="row">
                                <div class="col-lg-3 form-group">
                                    <label>Chart</label><span class="text-danger"> *</span>
                                    <select class="form-control m-b chosen-select" asp-for="idElement" asp-items="@(Model.ElementList)">
                                        <option value="0">Select One Option</option>
                                    </select>
                                </div>
                                <div class="col-lg-3 form-group" hidden id="child">
                                    <label>Chart</label><span class="text-danger"> *</span>
                                    <select class="form-control m-b chosen-select" asp-for="idChild" asp-items="@(Model.ChildList)">
                                        <option value="0">Select One Option</option>
                                    </select>
                                </div>
                                <div class="col-lg-2 form-group" hidden id="min">
                                    <label>Ref Min</label><span class="text-danger"> *</span>
                                    <input type="text" placeholder="Ref" class="form-control ref inputNumber" asp-for="RefMin">
                                </div>
                                <div class="col-lg-2 form-group" hidden id="max">
                                    <label>Ref Max</label><span class="text-danger"> *</span>
                                    <input type="text" placeholder="Ref" class="form-control ref inputNumber" asp-for="RefMax">
                                </div>
                                <div class="col-lg-2 form-group">
                                    <label>Reference</label><span class="text-danger"> *</span>
                                    <input type="text" placeholder="Ref" class="form-control ref inputNumber" asp-for="Reference">
                                </div>
                            </div>
                            <div class="form-group row text-center">
                                <div class="col-lg-12">
                                    <button id="btn-save" class="btn btn-primary" type="submit"><i class="fa fa-save"></i> Save</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <table class="table table-striped table-bordered table-hover dataTables" id="table">
                        <thead>
                            <tr>
                                <th hidden>Name</th>
                                <th>Name</th>
                                <th>Parameters</th>
                                <th hidden>Reference</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{ foreach (var item in Model.List)
                                {
                                    <tr>
                                        <td hidden>
                                            @item.name_element
                                        </td>
                                        <td>
                                            @if (item.id_element == 16)
                                            {
                                                @(string.Concat(item.name_element, " (", item.childElement.Name, ")"));
                                            }
                                            else
                                            {
                                                @item.name_element
                                            }
                                        </td>
                                        <td width=300>
                                            @if (item.id_element == 16)
                                            {
                                                <span>Min</span>
                                                <input type="text" value="@item.refmin" style="width:70px" class="form-control ref inputNumber" id="@item.Id" data-id="@item.Id">
                                                <span>Max</span>
                                                <input type="text" value="@item.refmax" style="width:70px" class="form-control ref inputNumber" id="@item.Id" data-id="@item.Id">
                                                <span>Ref</span>
                                                <input type="text" value="@item.reference" style="width:70px" class="form-control ref inputNumber" id="@item.Id" data-id="@item.Id">
                                            }
                                            else
                                            {
                                                <span>Ref</span>
                                                <input type="text" value="@item.reference" style="width:270px" class="form-control ref inputNumber" id="@item.Id" data-id="@item.Id">
                                            }
                                        </td>
                                        <td hidden>
                                            @string.Format("{0:N}", decimal.Parse(item.reference))
                                        </td>
                                        <td class="text-center">
                                            <a data-id="@item.Id" class="btn btn-danger delete">
                                                <i class="fa fa-trash"></i> Remove
                                            </a>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="~/js/plugins/dataTables/datatables.min.js"></script>
    <script src="~/js/plugins/dataTables/dataTablesCustom.js"></script>
    <script src="~/js/plugins/toastr/toastr.min.js"></script>

    <script>
    $(document).ready(function ()
    {
          $('.inputNumber').inputmask("decimal",
            {
                'alias': 'numeric',
                'groupSeparator': '.',
                'radixPoint': ',',
                'autoGroup': true,
                'digits': 2,
                'digitsOptional': false,
                'placeholder': '0',
              });

        formatearDataTableOriginal("#table", "@ViewData["Title"]", [0,3], null);
        $('#table tbody').on('click', '.delete', function () {
            eliminarRegistro(".delete", "data-id", "@Url.Action("Remove", "ReferenceParameters")", '#table', $(this));
        });
       });

        $('form').submit(function () {
            if ($('#idElement').val() == 16 ? ($('#Reference').val() == "" || $('#idElement').val() == 0 || $('#idChild').val() == 0 || $('#RefMin').val() == "" || $('#RefMax').val() == "" ) : ($('#Reference').val() == "" || $('#idElement').val() == 0 )) {
                toastr.error("Enter the fields marked as required");
                return false;
            }
            return true;
        });

        $(".ref").on('change', function () {
        var link = $(this);
            $.ajax({
                url: '@Url.Action("UpdateRef", "ReferenceParameters")',
                type: 'GET',
                data: { Id: link.attr("data-id"), TypeRef: link.attr("data-ref"), Ref: link.val()},
                success: function (retorno) {
                    if (retorno.aaData == true) {
                        toastr.clear();
                        toastr.success("Update successful");
                    }
                }
            });
        });
        $("#idElement").on('change', function () {
            if ($("#idElement").val() == 16) {
                $("#child").show();
                $("#min").show();
                $("#max").show();
            } else {
                $("#child").hide();
                $("#min").hide();
                $("#max").hide();
            }
        });

    </script>
}
